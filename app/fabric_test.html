<html>
<head>
    <script src="./HumanTemplate" type="text/javascript"></script> 
    <script src="./bower_components/fabric.js/dist/fabric.js" type="text/javascript"></script> 
    <style>
        body {
            background-color: black;
        }
        #humanTemplate {
            background-color: white;
        }
        #data {
            background-color: white;
            color: black;
        }
    </style>
</head>
<body>
    <canvas id="humanTemplate" width="400px" height="450px"></canvas>
    <div id="data"></div>
    <script>
        var canvas, ctx, img, model;

        function base64HumanTemplateSrc() {
            return "data:image/png;base64," + resource.Base64Image;
        }

        function objects_to_data(event) {
            var objects = canvas.getObjects();
            objects.forEach(function(o){
                console.log(o.top + " " + o.left + " " + o.angle);
            });
            // var data = document.getElementById('data');
        }

        function getMouseCoords(event) {
            var pointer = canvas.getPointer(event.e);
            var posX = pointer.x;
            var posY = pointer.y;
            console.log(posX+", "+posY);    // Log to console
            
            var imgBound = img.getBoundingRect();
            addPoint(posX, posY);
        }

        function changePoint(event) {
            console.log(event);
        }

        function addPoint(posX, posY) {
            var circle = new fabric.Circle({
                  radius: 2,
                  fill: 'red',
                  left: posX,
                  top: posY

            });
            circle.on('selected', function(){ console.log('foo')});
            canvas.add(circle);
        }

        document.addEventListener('DOMContentLoaded', function(){
            canvas = new fabric.Canvas('humanTemplate');
            canvas.selection = false;
            canvas.on("object:selected", objects_to_data);
            var humanTemplateImg = new fabric.Image.fromURL(
                base64HumanTemplateSrc(),
                function(newImg){
                    img = newImg;
                    img.set({
                        left: 0,
                        top: 0,
                        angle: 0,
                        opacity: 0.85,
                        selectable: false,
                        hoverCursor: 'pointer'
                    });
                    img.on("mousedown", getMouseCoords);
                    canvas.add(img).renderAll();
                }
            );
        });

    </script>
</body>
</html>
